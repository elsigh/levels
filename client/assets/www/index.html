<!DOCTYPE html>
  <html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="format-detection" content="telephone=no,email=no,address=no">
    <meta name="viewport"
      content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height">

    <!-- target-densitydpi=device-dpi -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/account.css">
    <link rel="stylesheet" href="css/following.css">
    <link rel="stylesheet" href="css/rickshaw.css">

    <title>Level</title>
    <!--
    <script src="http://192.168.1.8:8090/target/target-script-min.js#anonymous"></script>
    -->
  </head>
  <body>
    <div class="fmb-app">
      <h1>Level</h1>
      <section class="tabs">
        <a href="following" class="following">Following</a><a
          href="account" class="account">Account</a><span
          class="share">Share!</share>
      </section>
      <section class="fmb-tab fmb-tab-account">
        <div class="fmb-account"></div>
      </section>
      <section class="fmb-tab fmb-tab-following">
        <div class="fmb-following"></div>
      </section>
    </div>

    <script src="js/cordova-2.5.0.js"></script>
    <script src="js/phonediedservice_plugin.js"></script>
    <script src="js/webintent.js"></script>
    <script src="js/ContactView.js"></script>
    <script src="js/zepto-1.0rc1.js"></script>
    <script src="js/touch.js"></script>
    <script src="js/underscore-1.4.4.js"></script>
    <script src="js/backbone-1.0.js"></script>
    <script src="js/backbone.localStorage.js"></script>
    <script src="js/backbone-identity-map.js"></script>
    <script src="js/hogan-2.0.0.js"></script>
    <script src="js/d3.v2.js"></script>
    <script src="js/rickshaw.js"></script>

    <script src="js/app.js"></script>
    <script src="js/models_fmb.js"></script>
    <script src="js/models.js"></script>
    <script src="js/views.js"></script>

    <script id="tpl_account" type="text/html">
      {{^user.api_token}}
        <h2>Welcome to the App!</h2>
        <p>
          Send family and friends a notification *before* your battery dies!
        </p>
        <p>
          To get started:
        </p>
        <div class="login-google"><span>Sign in with Google</span></div>
      {{/user.api_token}}

      {{#user.api_token}}
        <div class="user-img-name">
          <img src="{{user.avatar_url}}" width="100" alt="">
          <h3>{{user.name}}</h3>
        </div>
      {{/user.api_token}}
    </script>

    <script id="tpl_device" type="text/html">
      <form method="post"
        class="device-update"
        action="{{api_server}}/api/device">
        <h3>
          {{platform}}
          {{name}}
        </h3>
      </form>
    </script>

    <script id="tpl_notifying" type="text/html">
      <p>
        Sends a notification when your battery hits 10%
      </p>

      <button class="notifying-add-phone">+ by phone</button>
      <button class="notifying-add-email">+ by email</button>

      <table>
        <thead>
          <tr>
            <th>name</th>
            <th>contact</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {{#notifying.length}}
            {{#notifying}}
              <tr>
                <td>
                  <span class="notifying-name">{{name}}</span>
                </td>
                <td>
                  {{means}}
                </td>
                <td class="remove-cell">
                  <div class="remove" data-means="{{means}}">X</div>
                </td>
              </tr>
            {{/notifying}}
          {{/notifying.length}}

          {{^notifying.length}}
            <tr>
              <td colspan="3">
                Show them you care, add somebody you love.
              </td>
            </tr>
          {{/notifying.length}}

        </tbody>
      </table>
    </script>


    <script id="tpl_following" type="text/html">
      <div class="fmb-tab-header">
        <h3>Following</h3>
        <button class="share">+ someone</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>name</th>
            <th>device</th>
            <th colspan="2">battery</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="5">
              Follow more batteries!
            </td>
          </tr>
        </tfoot>
      </table>
    </script>

    <script id="tpl_following_user" type="text/html">
      <tr>
        <td>
          <h3>{{name}}</h3>
        </td>
        <td colspan="2"></td>
        <td class="remove-cell">
          <div class="remove" data-userkey="{{key}}">X</div>
        </td>
      </tr>
    </script>

    <script id="tpl_following_device" type="text/html">
      <td colspan="2">{{platform}} {{name}}</td>
      <td
        class="battery-level-c charging-{{settings.0.is_charging}}">
        <div class="battery-level"
          style="background-image:-webkit-gradient(linear, left top, right top, color-stop({{settings.0.battery_level}}%, green), color-stop({{settings.0.battery_level}}%, white))">
          {{settings.0.battery_level}}%
        </div>
        <div class="battery-created">
          {{settings.0.created_pretty}}
        </div>
      </td>
      <td>
        <div class="battery-graph">
          <div class="y-axis"></div>
          <div class="chart"></div>
        </div>
      </td>
    </script>

    <script>
      window.onerror = function(message, url, lineNumber) {
        console.log('window.onerror GLOBAL FAIL: ' + message + ', ' +
                    url + ', ' + lineNumber);
      };
      window.templates = {};
      $('script[type="text/html"]').each(function(i, script) {
        var name = script.id.replace('tpl_', '');
        var html = $(script).html().trim();
        window.templates[name] = Hogan.compile(html);
      });

      document.addEventListener('deviceready', function() {
        window['app'] = new fmb.App();
      }, false);

    </script>

    <script>
      // Super-wild-west-runtime-unit-testing.
      //$(document).ready(function() {
        if (window.location.search === '?test=1') {
          var testFiles = [
            'tests/closure_jsunit.js',
            'tests/sinon.js',
            'tests/app_test.js'
          ];
          $.each(testFiles, function(i, src) {
            document.write('<scr'+'ipt src="' + src + '"></sc'+'ript>');
          })
        }
      //})
    </script>
  </body>
  </html>
