<!DOCTYPE html>
  <html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="format-detection" content="telephone=no,email=no,address=no">
    <meta name="viewport"
      content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height">

    <!-- target-densitydpi=device-dpi -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/loading.css">
    <link rel="stylesheet" href="css/account.css">
    <link rel="stylesheet" href="css/following.css">
    <link rel="stylesheet" href="css/xcharts.css">

    <title>Level</title>
    <!--
    <script src="http://192.168.1.8:8090/target/target-script-min.js#anonymous"></script>
    -->
  </head>
  <body>
    <div class="fmb-app">
      <h1>Level</h1>
      <section class="tabs">
        <a href="following" class="following">Following</a><a
          href="account" class="account">Account</a><span
          class="share">Share!</share>
      </section>
      <section class="fmb-tab fmb-tab-account">
        <div class="fmb-account"></div>
      </section>
      <section class="fmb-tab fmb-tab-following">
        <div class="fmb-following"></div>
      </section>
      <div class="fmb-loading"
        style="display:none;position:absolute;top:10px;right:10px;"></div>
    </div>

    <script src="js/cordova-2.5.0.js"></script>
    <script src="js/phonediedservice_plugin.js"></script>
    <script src="js/webintent.js"></script>
    <script src="js/ContactView.js"></script>
    <script src="js/zepto-1.0rc1.js"></script>
    <script src="js/touch.js"></script>
    <script src="js/underscore-1.4.4.js"></script>
    <script src="js/backbone-1.0.js"></script>
    <script src="js/backbone.localStorage.js"></script>
    <script src="js/backbone-identity-map.js"></script>
    <script src="js/hogan-2.0.0.js"></script>
    <script src="js/d3.v2.js"></script>
    <script src="js/xcharts.js"></script>

    <script src="js/app.js"></script>
    <script src="js/models_fmb.js"></script>
    <script src="js/models.js"></script>
    <script src="js/views.js"></script>

    <script id="tpl_account" type="text/html">
      {{^user.api_token}}
        <h2>Welcome to the App!</h2>
        <p>
          Send family and friends a notification *before* your battery dies!
        </p>
        <p>
          To get started:
        </p>
        <div class="login-google"><span>Sign in with Google</span></div>
      {{/user.api_token}}

      {{#user.api_token}}
        <div class="user-img-name">
          <img src="{{user.avatar_url}}" alt="">
          <h2>{{user.name}}</h2>
        </div>
      {{/user.api_token}}
    </script>

    <script id="tpl_device" type="text/html">
      {{^is_user_device}}
        {{#key}}
          <div class="fmb-remove" data-key="{{key}}">X</div>
        {{/key}}
      {{/is_user_device}}

      <form method="post"
        class="device-update"
        action="{{api_server}}/api/device">
        <h3>
          {{platform}}
          {{name}}
        </h3>
      </form>
    </script>

    <script id="tpl_notifying" type="text/html">
      <p>
        Sends a notification when your battery hits 10%
      </p>

      <div class="fmb-button-c">
        <button class="notifying-add-phone">+ by phone</button>
        <button class="notifying-add-email">+ by email</button>
      </div>

          {{#notifying.length}}
      <table>
        <thead>
          <tr>
            <th>name</th>
            <th>contact</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
            {{#notifying}}
              <tr data-key="{{key}}">
                <td>
                  <span class="notifying-name">{{name}}</span>
                </td>
                <td>
                  {{means}}
                </td>
                <td>
                  {{#key}}
                    <div class="fmb-remove" data-key="{{key}}">X</div>
                  {{/key}}
                  {{^key}}
                    <div class="fmb-loading"></div>
                  {{/key}}
                </td>
              </tr>
            {{/notifying}}

        </tbody>
      </table>
          {{/notifying.length}}
    </script>


    <script id="tpl_following" type="text/html">
      <div class="fmb-tab-header">
        <button class="share">+ someone</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>device</th>
            <th>battery</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td colspan="2">
              Follow more batteries!
            </td>
          </tr>
        </tfoot>
      </table>
    </script>

    <script id="tpl_following_user" type="text/html">
      <tr class="fmb-following-ser">
        <td colspan="2">
          <h2 class="user-name">{{name}}</h2>

          {{^is_current_user}}
            {{#key}}
              <div class="fmb-remove" data-key="{{key}}">X</div>
            {{/key}}
            {{^key}}
              <div class="fmb-loading"></div>
            {{/key}}
          {{/is_current_user}}

        </td>
      </tr>
    </script>

    <script id="tpl_following_device" type="text/html">
      <td>
        <h4>{{platform}} {{name}}</h4>
        <div class="battery-level-c charging-{{settings.0.is_charging}}">
          <div class="battery-level"
            style="background-image:-webkit-gradient(linear, left top, right top, color-stop({{settings.0.battery_level}}%, #34b2e0), color-stop({{settings.0.battery_level}}%, #666666))">
            {{settings.0.battery_level}}%
          </div>
          <div class="battery-created">
            {{settings.0.created_pretty}}
          </div>
        </div>
      </td>
      <td>
        <figure
          class="battery-graph battery-graph-{{key}}"></figure>
      </td>
    </script>

    <script>
      window.onerror = function(message, url, lineNumber) {
        console.log('window.onerror GLOBAL FAIL: ' + message + ', ' +
                    url + ', ' + lineNumber);
      };
      window.templates = {};
      $('script[type="text/html"]').each(function(i, script) {
        var name = script.id.replace('tpl_', '');
        var html = $(script).html().trim();
        window.templates[name] = Hogan.compile(html);
      });

      document.addEventListener('deviceready', function() {
        window['app'] = new fmb.App();
      }, false);

    </script>

    <script>
      // Super-wild-west-runtime-unit-testing.
      //$(document).ready(function() {
        if (window.location.search === '?test=1') {
          var testFiles = [
            'tests/closure_jsunit.js',
            'tests/sinon.js',
            'tests/app_test.js'
          ];
          $.each(testFiles, function(i, src) {
            document.write('<scr'+'ipt src="' + src + '"></sc'+'ript>');
          })
        }
      //})
    </script>
  </body>
  </html>
