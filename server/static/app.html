<!DOCTYPE html>
  <html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="format-detection"
      content="telephone=no,email=no,address=no">
    <meta name="viewport"
      content="user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,width=device-width,height=device-height">

    <!-- target-densitydpi=device-dpi -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/loading.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/account.css">
    <link rel="stylesheet" href="css/following.css">
    <link rel="stylesheet" href="css/xcharts.css">

    <title>Levels</title>

  </head>
  <body>
    <div class="fmb-app">
      <div class="nav">
        <h1><span>Levels</span></h1>
      </div>
      <section class="tabs-c">
        <div class="tabs">
          <a href="account" class="account">Account</a><a href="following" class="following">Stats</a>
        </div>
      </section>
      <section class="fmb-tab fmb-tab-account">
        <div class="fmb-account"></div>
      </section>
      <section class="fmb-tab fmb-tab-following">
        <div class="fmb-following"></div>
      </section>
      <div class="fmb-loading" style="display:none;"></div>
    </div>
    <script>
      var cordovaSrc_;
      if (window.navigator.userAgent.match(/Android/i)) {
        cordovaSrc_ = 'cordova-android.js';
      } else if (window.navigator.userAgent.match(/iPad/i) ||
                 window.navigator.userAgent.match(/iPhone/i)) {
        cordovaSrc_ = 'cordova-ios.js';
      }
      if (cordovaSrc_) {
        document.write('<scr'+'ipt src="js/' + cordovaSrc_ + '"></sc'+'ript>');
      } else {
        // Stubs cordova so we can run this page on the web not as a
        // cordova app.
        cordova = {
          addConstructor: function() {},
          require: function() {},
          define: function() {}
        };
      }
    </script>
    <script src="js/levels_plugin.js"></script>
    <script src="js/webintent.js"></script>
    <script src="js/ContactView.js"></script>
    <script src="js/zepto.js"></script>
    <script src="js/touch.js"></script>
    <script src="js/underscore.js"></script>
    <script src="js/backbone.js"></script>
    <script src="js/backbone.localStorage.js"></script>
    <script src="js/backbone-identity-map.js"></script>
    <script src="js/hogan.js"></script>
    <script src="js/d3.v2.js"></script>
    <script src="js/xcharts.js"></script>
    <script src="js/GCMPlugin.js"></script>

    <script src="js/fmb.js"></script>
    <script src="js/app.js"></script>
    <script src="js/models_fmb.js"></script>
    <script src="js/models.js"></script>
    <script src="js/views.js"></script>

    <script id="tpl_account" type="text/html">
      {{^user.api_token}}
        <h2>Welcome!</h2>
        <p>
          Levels can automatically send yourself and your friends and family a
          notification *before* your battery dies!
        </p>
        <p>
          Step 1:
        </p>
        <div class="login-google"><span>Sign in with Google</span></div>
        <p>
          <em>
            This will open a new window for you to sign in and
            then bring you back to the app.
          </em>
        </p>
        <p>
          <em>
            Levels will <strong>never</strong>
            automatically post anything to any social network on your behalf.
          </em>
        </p>
      {{/user.api_token}}

      {{#user.api_token}}
        <div class="user-header">
          <img src="{{user.avatar_url}}" alt="">
          <div class="user-info">
            <h2>{{user.name}}</h2>

            <div>
              <div class="share">
                levelsapp.com/p/{{user.unique_profile_str}}
              </div>
            </div>

            {{#user.is_gmail_account}}
              <div class="label-c">
                <label>
                  <input
                    type="checkbox"
                    name="allow_gmail_lookup"
                    {{#user.allow_gmail_lookup}}checked{{/user.allow_gmail_lookup}}>
                  Use gmail name for my profile url.
                </label>
              </div>
            {{/user.is_gmail_account}}

            <!--
            <div>
              www.levelsapp.com/n/{{user.unique_profile_str}}
            </div>
            <label>
              <input
                type="checkbox"
                name="allow_phone_lookup"
                {{#user.allow_phone_lookup}}checked{{/user.allow_phone_lookup}}>
              Others can use my phone number for reverse lookups.
            </label>
            -->

          </div>
        </div>
      {{/user.api_token}}
    </script>

    <script id="tpl_device" type="text/html">
      {{^is_user_device}}
        {{#key}}
          <button type="button" class="fmb-remove device-remove"
            data-key="{{key}}">X</button>
        {{/key}}
      {{/is_user_device}}

      <form method="post"
        class="device-update"
        action="{{api_server}}/api/device">
        <h3>
          {{platform}}
          {{name}}
        </h3>
      </form>
    </script>

    <script id="tpl_notifying" type="text/html">
      <p class="info-headline">
        <strong>Send Notifications</strong>: when your battery reaches 10%
      </p>

      <div class="fmb-button-c">
        <button class="notifying-add-phone">by phone</button>
        <button class="notifying-add-email">by email</button>
      </div>

      {{#notifying.length}}
        <table>
          <thead>
            <tr>
              <th>name</th>
              <th>contact</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#notifying}}
              <tr data-key="{{key}}">
                <td>
                  <span class="notifying-name">{{name}}</span>
                </td>
                <td>
                  {{means}}
                </td>
                <td>
                  {{^is_user_email}}
                    {{#key}}
                      <button type="button" class="fmb-remove notifying-remove"
                        data-key="{{key}}"
                        data-means="{{means}}">X</button>
                    {{/key}}
                    {{^key}}
                      <div class="fmb-loading"></div>
                    {{/key}}
                  {{/is_user_email}}
                </td>
              </tr>
            {{/notifying}}
          </tbody>
        </table>
      {{/notifying.length}}
      {{^notifying.length}}
        <p>
          <strong>Add someone from your contact book with the buttons above.</strong>
        </p>
      {{/notifying.length}}
    </script>


    <script id="tpl_following" type="text/html">
      <!--
      <div class="fmb-tab-header">
        <button class="share">get more stats</button>
      </div>
      -->
      <p class="info-other-users">
        <span class="info">i</span>
        If you open someone's Levels link with the app, they'll show up here.
      </p>
      <table>
        <thead>
          <tr>
            <th>device</th>
            <th>battery</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td colspan="2">
              Follow more batteries!
            </td>
          </tr>
        </tfoot>
      </table>
    </script>

    <script id="tpl_following_user" type="text/html">
      <tr class="following-user">
        <td colspan="2">
          <h2 class="user-name"
            style="background-image:url({{avatar_url}})">{{name}}</h2>

          {{^is_current_user}}
            {{#key}}
              <button type="button" class="fmb-remove following-user-remove"
                data-key="{{key}}">X</button>
            {{/key}}
            {{^key}}
              <div class="fmb-loading"></div>
            {{/key}}
          {{/is_current_user}}
        </td>
      </tr>
    </script>

    <script id="tpl_following_device" type="text/html">
      <td>
        <h4>{{platform}} {{name}}</h4>

        <div class="battery-level-c charging-{{settings.0.is_charging}}">
          <div class="battery-level"
            style="background-image:-webkit-gradient(linear, left top, right top, color-stop({{settings.0.battery_level}}%, #3b97d1), color-stop({{settings.0.battery_level}}%, #666666))">
            {{settings.0.battery_level}}%
          </div>
          <div class="battery-created">
            {{settings.0.created_pretty}}
          </div>
        </div>

        <ul class="counters">
          <li>
            <strong>{{send_battery_notifications_count}}</strong>
            notification{{#send_battery_notifications_count_is_plural}}s{{/send_battery_notifications_count_is_plural}}.
          </li>
          <li>
            <strong>{{settings_received_count}}</strong>
            level{{#settings_received_count_is_plural}}s{{/settings_received_count_is_plural}} saved.
          </li>
        </ul>
      </td>
      <td>
        <figure class="battery-graph battery-graph-{{key}}"></figure>
      </td>
    </script>

    <script>
      // Catch-all.
      window.onerror = function(message, url, lineNumber) {
        window.console.log('window.onerror GLOBAL FAIL: ' + message + ', ' +
            url + ', ' + lineNumber);
      };

      // Hogan.
      window.templates = {};
      $('script[type="text/html"]').each(function(i, script) {
        var name = script.id.replace('tpl_', '');
        var html = $(script).html().trim();
        window.templates[name] = Hogan.compile(html);
      });

      // Super-wild-west-runtime-unit-testing.
      if (window.location.search.indexOf('?test=1') !== -1) {
        var testFiles = [
          'closure_jsunit.js',
          'sinon.js',
          'app_test.js'
        ];
        $.each(testFiles, function(i, src) {
          document.write('<scr'+'ipt src="' + src + '"></sc'+'ript>');
        });

      // Load the app as a cordova app.
      } else if (cordovaSrc_) {
        document.addEventListener('deviceready', function() {
          window['app'] = new fmb.App();
        }, false);

      // Load the app ala webapp style.
      } else {
        $(document).ready(function() {
          window['app'] = new fmb.App();
        });
      }

      if (window.location.href.match(/levelsapp.com/i)) {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-41823667-1', 'levelsapp.com');
        ga('send', 'pageview');
      }
    </script>
  </body>
  </html>
